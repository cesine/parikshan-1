
\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=0.5\textwidth]{figs/arch.png}
		\caption{\parikshan applied to a mid-tier service: It is comprised of (1) Clone Manager for Live Cloning, (2) Proxy Duplicator to duplicate network traffic, and (3) Proxy Aggregator to replay network traffic to the cloned debug container.}
		\label{fig:workflow}
	\end{center}
\end{figure}

%\vspace{-0.5cm}
\section{Design}
\label{sec:design}

In Figure~\ref{fig:workflow}, we show the architecture of \parikshan when applied to a single mid-tier application server.
\parikshan consists of 3 modules: 
\textbf{Clone Manager}: manages ``live cloning'' between the production and the debug containers, 
\textbf{Network Duplicator}: manages network traffic duplication from downstream servers to both the production and debug containers, 
and \textbf{Network Aggregator}: manages network communication from the production and debug containers to upstream servers.
The duplicator and aggregator can be used to target multiple connected tiers of a system by duplicating traffic at the beginning and end of a workflow.
Furthermore, the aggregator module is not required if the debug-container has no upstream services. 
At the end of this section, we also discuss the \textbf{debug window} during which we believe that the debug-container faithfully represents the execution of the production container.
Finally, we discuss \textbf{divergence checking} which allows us to observe if the production and debug containers are still in sync.


\input{clone}
\input{proxyDup}
\input{proxyAgg}
\input{window}
\input{divergence}

